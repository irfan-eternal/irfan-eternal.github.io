<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Analysing .NET AsyncRAT using dnSpy - irfan_eternal</title><meta name=Description content="Analysing .NET AsyncRAT using dnSpy"><meta property="og:title" content="Analysing .NET AsyncRAT using dnSpy"><meta property="og:description" content="Analysing .NET AsyncRAT using dnSpy"><meta property="og:type" content="article"><meta property="og:url" content="https://irfan-eternal.github.io/analysing-.net-asyncrat-using-dnspy/"><meta property="og:image" content="https://irfan-eternal.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-19T11:35:00+08:00"><meta property="article:modified_time" content="2023-08-19T12:59:47-04:00"><meta property="og:site_name" content="irfan_eternal"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://irfan-eternal.github.io/logo.png"><meta name=twitter:title content="Analysing .NET AsyncRAT using dnSpy"><meta name=twitter:description content="Analysing .NET AsyncRAT using dnSpy"><meta name=application-name content="irfan_eternal"><meta name=apple-mobile-web-app-title content="irfan_eternal"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://irfan-eternal.github.io/analysing-.net-asyncrat-using-dnspy/><link rel=prev href=https://irfan-eternal.github.io/guloader-deobfuscation-using-ghidra/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Analysing .NET AsyncRAT using dnSpy","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/irfan-eternal.github.io\/analysing-.net-asyncrat-using-dnspy\/"},"image":[{"@type":"ImageObject","url":"https:\/\/irfan-eternal.github.io\/images\/Apple-Devices-Preview.png","width":3200,"height":2048}],"genre":"posts","wordcount":796,"url":"https:\/\/irfan-eternal.github.io\/analysing-.net-asyncrat-using-dnspy\/","datePublished":"2023-08-19T11:35:00+08:00","dateModified":"2023-08-19T12:59:47-04:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"irfan_eternal","logo":{"@type":"ImageObject","url":"https:\/\/irfan-eternal.github.io\/images\/avatar.png","width":400,"height":400}},"author":{"@type":"Person","name":"irfan_eternal"},"description":"Analysing .NET AsyncRAT using dnSpy"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=irfan_eternal>irfan_eternal</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About Me </a><a class=menu-item href=https://github.com/irfan-eternal title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><a class=menu-item href=/></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=irfan_eternal>irfan_eternal</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About Me</a><a class=menu-item href=https://github.com/irfan-eternal title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a class=menu-item href=/ title></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Analysing .NET AsyncRAT using dnSpy</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://twitter.com/irfan_eternal title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>irfan_eternal</a></span>&nbsp;<span class=post-category>included in <a href=/categories/malware-analysis/><i class="far fa-folder fa-fw" aria-hidden=true></i>Malware Analysis</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-08-19>2023-08-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;796 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/static_dec.png data-srcset="/analysing-.net-asyncrat-using-dnspy/static_dec.png, /analysing-.net-asyncrat-using-dnspy/static_dec.png 1.5x, /analysing-.net-asyncrat-using-dnspy/static_dec.png 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/static_dec.png title="Analysing .NET AsyncRAT using dnSpy" width=1275 height=794></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#analysis>Analysis</a><ul><li><a href=#static-config-extraction>Static Config Extraction</a></li><li><a href=#anti-vm-technique>Anti-VM Technique</a></li><li><a href=#anti-debugging-technique>Anti-Debugging Technique</a></li><li><a href=#anti-sandbox-technique>Anti-Sandbox Technique</a></li><li><a href=#other-checks>Other Checks</a></li><li><a href=#persistance>Persistance</a></li><li><a href=#stop-from-termination>Stop From Termination</a></li><li><a href=#key-logging>Key Logging</a></li><li><a href=#data-stealing-and-exfilteration>Data Stealing and Exfilteration</a></li></ul></li><li><a href=#indicators-of-compromise>Indicators of Compromise</a></li><li><a href=#references>References</a></li></ul></nav></div></div><div class=content id=content><h2 id=introduction>Introduction</h2><p>Hi all, Today we will be Analysing .NET AsynRAT using dnSpy.In this blog we will be Discussing About Static Extraction of the Config and we will also look at some of the Capabilites of AsyncRAT.</p><h2 id=analysis>Analysis</h2><p>For Readers who want to Follow along can get the sample from <a href=https://bazaar.abuse.ch/sample/8da2ee52332138905d6c21a8c2fd16c1ccb16aa057b64df7e66f2bd38664e86f/ target=_blank rel="noopener noreffer">MalwareBazaar</a> .The Sample was First Seen on 2023-07-04 07:07:39 UTC
. The sample is 32bit so you can use dnSpy 32 Bit Version.</p><h3 id=static-config-extraction>Static Config Extraction</h3><p>When You go to the Entrypoint Function Main there is a Method called <strong>RBReueVXBVIYiq</strong> Which sets all the Config Data. If you take a Closer look you can understand a Pattern.
<img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/ConfigCollection.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/ConfigCollection.PNG, /analysing-.net-asyncrat-using-dnspy/ConfigCollection.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/ConfigCollection.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/ConfigCollection.PNG title=ConfigCollection width=1130 height=401>
Most of the Config Data is Set using the method <strong>isVjrDwVFds</strong> which takes a Field of <strong>eDraegaZqrr</strong> as an Argument. When You look at <strong>isVjrDwVFds</strong> it converts the argument from Base64 and Call the Method <strong>QpLgTABIbRB</strong> with the return value. Here is the Actual Decryption taking place. It uses AES CBC and SHA256 inside the Decryption Function
<img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/dec_fun.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/dec_fun.PNG, /analysing-.net-asyncrat-using-dnspy/dec_fun.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/dec_fun.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/dec_fun.PNG title=dec_fun.PNG width=1356 height=581>
I tried using de4dot and Powershell to Decrypt the Config but they failed. So I tried to replicate the Decryption function in Python
Steps I Followed</p><ol><li>Copy all the Content from the <strong>eDraegaZqrr</strong> Class</li><li>Visit this <a href="https://gchq.github.io/CyberChef/#recipe=Regular_expression%28%27User%20defined%27,%27%22%28.*?%29%22%27,true,true,false,false,false,false,%27List%20matches%27%29" target=_blank rel="noopener noreffer">Cyberchef Recipie</a> and Paste the Contents of <strong>eDraegaZqrr</strong> Class . The Recipie uses this regex &ldquo;(.*?)&rdquo; to Get the Value of the fields from <strong>eDraegaZqrr</strong></li><li>Get the Config Extractor script from <a href=https://github.com/irfan-eternal/blog_temp/blob/main/AzyncRAT/config_extract.py target=_blank rel="noopener noreffer">here</a> and Add the Contents you got from Step2 as Elements of the array enc in main function and run the Script You will get all the Config Data</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Protocol</span> <span class=kn>import</span> <span class=n>KDF</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>unpad</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>s</span><span class=p>[:</span><span class=o>-</span><span class=nb>ord</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>:])]</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>enc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>enc</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>enc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>password</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=s2>&#34;W1h0cU9mc0E3S0VFcEt1Y3F4d1BkZTRMTk1vZ1A5aWY=&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>salt</span> <span class=o>=</span>  <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\xbf\xeb\x1e\x56\xfb\xcd\x97\x3b\xb2\x19\x02\x24\x30\xa5\x78\x43\x00\x3d\x56\x44\xd2\x1e\x62\xb9\xd4\xf1\x80\xe7\xe6\xc3\x39\x41</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>  <span class=n>iteration</span>  <span class=o>=</span> <span class=mi>50000</span>
</span></span><span class=line><span class=cl>  <span class=n>stream</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>pbkdf2_hmac</span><span class=p>(</span><span class=s2>&#34;shal&#34;</span><span class=p>,</span> <span class=n>password</span><span class=p>,</span> <span class=n>salt</span><span class=p>,</span> <span class=n>iteration</span><span class=p>,</span> <span class=n>dklen</span> <span class=o>=</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>aeskey</span> <span class=o>=</span>  <span class=n>stream</span><span class=p>[:</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=n>sha256key</span> <span class=o>=</span> <span class=n>stream</span><span class=p>[:</span><span class=mi>62</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=n>HMACObject</span> <span class=o>=</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>sha256key</span><span class=p>,</span> <span class=n>msg</span><span class=o>=</span><span class=n>enc</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=nb>len</span><span class=p>(</span><span class=n>enc</span><span class=p>)</span><span class=o>-</span><span class=mi>32</span><span class=p>],</span> <span class=n>digestmod</span><span class=o>=</span><span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>memoryStream</span> <span class=o>=</span> <span class=n>HMACObject</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>array2</span> <span class=o>=</span> <span class=n>memoryStream</span><span class=p>[:</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=n>iv</span> <span class=o>=</span>  <span class=n>memoryStream</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=n>encrypted_text</span><span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>memoryStream</span><span class=p>[</span><span class=mi>48</span><span class=p>:],</span> <span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>plain</span> <span class=o>=</span>  <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>aeskey</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>iv</span><span class=p>,</span> <span class=s1>&#39;latin-1&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>plain_text</span><span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>plain</span><span class=o>.</span><span class=n>decrypt</span> <span class=p>(</span><span class=n>enc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>plain_text</span><span class=p>[</span><span class=mi>48</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=n>enc</span>  <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>enc</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>decrypted_text</span> <span class=o>=</span>  <span class=n>decrypt</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nb>print</span><span class=p>(</span><span class=n>decrypted_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      
</span></span></code></pre></td></tr></table></div></div><p>I tried de4dot and Powershell Scripts(Invoke) to decrypt the Config the Data but they failed. You can also Decrypt the Config by debugginh But you to need to pass all the Ant-Analysis checks</p><p>Next we will look at the Capabilities of the AsyncRAT Sample</p><h3 id=anti-vm-technique>Anti-VM Technique</h3><p>The Sample uses WMI Queries to Check the Manufacturer Details and check if it contains VM related strings like VirtualBox, vmware, VIRTUAL . if this is the case The malware Exits
<img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/Anti-VM.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/Anti-VM.PNG, /analysing-.net-asyncrat-using-dnspy/Anti-VM.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/Anti-VM.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/Anti-VM.PNG title=Anti-VM.PNG width=1526 height=370></p><h3 id=anti-debugging-technique>Anti-Debugging Technique</h3><p>The Sample get the Current Process Handle and uses CheckRemoteDebuggerPresent API to Check if there is any remote Debugger is Attached to the Process . if this is the case The malware Exits
<img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/Anti_debugging.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/Anti_debugging.PNG, /analysing-.net-asyncrat-using-dnspy/Anti_debugging.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/Anti_debugging.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/Anti_debugging.PNG title=Anti_debugging.PNG width=881 height=240></p><h3 id=anti-sandbox-technique>Anti-Sandbox Technique</h3><p>The Malware checks if it is Running in any Sandbox environment by Checking if SbieDll.dll is Loaded into process memory . This DLL is used by some <a href=https://sandboxie-website-archive.github.io/www.sandboxie.com/SBIE_DLL_API.html target=_blank rel="noopener noreffer">sandboxes</a>. if SbieDll is present The malware Exits
<img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/Anti-Sandbox.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/Anti-Sandbox.PNG, /analysing-.net-asyncrat-using-dnspy/Anti-Sandbox.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/Anti-Sandbox.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/Anti-Sandbox.PNG title=Anti-Sandboxdebugging.PNG width=680 height=303></p><h3 id=other-checks>Other Checks</h3><p>It also Checks the Drive Size if the Size is less than the Hardcoded Value the Malware Exits</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/DriveSize.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/DriveSize.PNG, /analysing-.net-asyncrat-using-dnspy/DriveSize.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/DriveSize.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/DriveSize.PNG title=DriveSize.PNG width=833 height=208></p><p>It Also Checks if the OSName contains XP if this is the case the Malware Exits
<img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/xp.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/xp.PNG, /analysing-.net-asyncrat-using-dnspy/xp.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/xp.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/xp.PNG title=xp.PNG width=608 height=218></p><h3 id=persistance>Persistance</h3><p>The Sample Checks whether it has Administrator privileges If yes it uses cmd to create a schedule task to achieve Persistance. If it is Not an Administrator it uses the autorun key SOFTWARE\Microsoft\Windows\CurrentVersion\Run to Achieve Persistance</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/persistance.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/persistance.PNG, /analysing-.net-asyncrat-using-dnspy/persistance.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/persistance.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/persistance.PNG title=persistance.PNG width=1265 height=857></p><h3 id=stop-from-termination>Stop From Termination</h3><p>If it has Adminstrator privileges it is Given SeDebugPrivilege . By default, users can debug only processes that they own. By giving SeDebugPrivilege privilege it can debug processes owned by other users. After that it Uses RtlSetProcessIsCritical API which set the process to a system critical status. This means that the process is now &ldquo;critical&rdquo; to the running of Windows, which also means that on termination of the process, Windows itself terminates as well.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/SeDebug.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/SeDebug.PNG, /analysing-.net-asyncrat-using-dnspy/SeDebug.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/SeDebug.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/SeDebug.PNG title=SeDebug.PNG width=692 height=181></p><h3 id=key-logging>Key Logging</h3><p>It uses SetWindowsHookEx API to install a Hook procedure on all low level keyboard input Events. it stores the key logging data in %temp%log.tmp file and Exfilterated this Data</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/keylogging.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/keylogging.PNG, /analysing-.net-asyncrat-using-dnspy/keylogging.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/keylogging.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/keylogging.PNG title=keylogging.PNG width=1227 height=855></p><h3 id=data-stealing-and-exfilteration>Data Stealing and Exfilteration</h3><p>It Collects Basic Information Like Username, OS, Executable Path, Anti Viruses etc. It Also Steals Data from Browsers like Firefox, Brave, Chrome, Opera, Edge. It Also Checks For Crypto wallets like Binannce, Trust, MetaMask
<img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/data_collected.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/data_collected.PNG, /analysing-.net-asyncrat-using-dnspy/data_collected.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/data_collected.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/data_collected.PNG title=data_collected.PNG width=1784 height=821></p><p>After Collection it Compresses the Data using GZip Stream and Exfilterate the Data to Cnc josemonila[.]ddnsfree[.]com using Socket Class for CnC Communication
<img class=lazyload src=/svg/loading.min.svg data-src=/analysing-.net-asyncrat-using-dnspy/socket.PNG data-srcset="/analysing-.net-asyncrat-using-dnspy/socket.PNG, /analysing-.net-asyncrat-using-dnspy/socket.PNG 1.5x, /analysing-.net-asyncrat-using-dnspy/socket.PNG 2x" data-sizes=auto alt=/analysing-.net-asyncrat-using-dnspy/socket.PNG title=socket.PNG width=1078 height=572></p><h2 id=indicators-of-compromise>Indicators of Compromise</h2><table><thead><tr><th>Type</th><th>Indicator</th><th>Description</th></tr></thead><tbody><tr><td>SHA256</td><td>8da2ee52332138905d6c21a8c2fd16c1ccb16aa057b64df7e66f2bd38664e86f</td><td>Initial File</td></tr><tr><td>CnC</td><td>josemonila[.]ddnsfree[.]com</td><td>Exfilteration of Data</td></tr><tr><td>Mutex</td><td>AsyncMutex_6SI80kPnk</td><td>To make sure to Run only once</td></tr></tbody></table><h2 id=references>References</h2><ol><li><a href=https://stackoverflow.com/questions/12524994/encrypt-and-decrypt-using-pycrypto-aes-256 target=_blank rel="noopener noreffer">Stackoverflow</a></li><li><a href=https://www.codeproject.com/Articles/43405/Protecting-Your-Process-with-RtlSetProcessIsCriti target=_blank rel="noopener noreffer">codeproject</a></li></ol></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-08-19&nbsp;<a class=git-hash href=https://github.com/dillonzq/LoveIt/commit/8b938c615eb2a4cc341776347a497f44cd6d0149 target=_blank title="commit by irfan-eternal(irfan_eternal@proton.me) 8b938c615eb2a4cc341776347a497f44cd6d0149: 6th article First  Draft">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>8b938c6</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/analysing-.net-asyncrat-using-dnspy/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://irfan-eternal.github.io/analysing-.net-asyncrat-using-dnspy/ data-title="Analysing .NET AsyncRAT using dnSpy" data-via=irfan_eternal><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://irfan-eternal.github.io/analysing-.net-asyncrat-using-dnspy/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://irfan-eternal.github.io/analysing-.net-asyncrat-using-dnspy/ data-title="Analysing .NET AsyncRAT using dnSpy"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://irfan-eternal.github.io/analysing-.net-asyncrat-using-dnspy/ data-title="Analysing .NET AsyncRAT using dnSpy"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://irfan-eternal.github.io/analysing-.net-asyncrat-using-dnspy/ data-title="Analysing .NET AsyncRAT using dnSpy" data-image=static_dec.png><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/guloader-deobfuscation-using-ghidra/ class=prev rel=prev title="Guloader Deobfuscation using Ghidra"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Guloader Deobfuscation using Ghidra</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.117.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>irfan_eternal</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>